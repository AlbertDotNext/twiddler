<!DOCTYPE html>
<html>
  <head>
    <title>Twiddler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>

  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        var $refreshMe = $('<button type = "button" id = "refreshMe" style = "color:blue" > Refresh New Tweets Here!</button>');
        $refreshMe.appendTo($body);
        $('<br></br><br></br>').appendTo('body');

        // tweets created by using streams.home
        $refreshMe.on('click', function(){
          //var streamsHomeLength = streams.home.length;
          for(var i = 0; i < 20; i++){
            generateRandomTweet();
          }
          scheduleNextTweet();
          display();

        });

        var display = function (){
          var index = streams.home.length - 1;
          
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<div id="tweets"></div>');
            var $userClick = $('<button type="button" style = "color:blue" id='+tweet.user+' data-name="'+tweet.user+'">'+ tweet.user +'</button>');
            
            var userName = '<a href=# class="user" data-toggle="modal" data-target="#myModal">' + tweet.user + '</a>'
            $tweet.html('<br>' + '@' + userName + ': ' + '<br><br>' + tweet.message + ' ' + '<br>').appendTo($('ul'));
            $tweet.prepend($userClick);
            $tweet.appendTo($body);
            $('<p style="font-size: 10px"> Tweeted Time: </p>').append(Date($.now())).appendTo($tweet);
            index -= 1;
            
            $('div #' + tweet.user).on('click', function() {
              var username = $(this).closest('button').attr('id');
              userTimeline(username);
            
            });
            
          }
        }
        
        var userTimeline = function(username){
          var $backRefresh = $('<button type = "button" id = "backRefresh" style = "color:blue" onClick="history.go(0)"> Back To Homepage </button>');
        
          $refreshMe.remove();
          var allTweets = streams.users[username];
          $('div').remove();
          var $allTweets = $('<div></div>');

          $allTweets.prepend($('<br></br>'));
          $allTweets.prepend('@' + username + ' tweets: ');
          for(var i = 0; i < allTweets.length; i++){
            var thisTweet = allTweets[i].message;
            var thisTime = $('<p style="font-size: 10px">'+username+' Tweeted Time: </p>').append(allTweets[i].created_at);
            $allTweets.append(thisTweet);
            $allTweets.append(thisTime);
          }
          $allTweets.appendTo($body);
          $backRefresh.appendTo($allTweets);
          //document.getElementById("demo").innerHTML = "Hello World";
        }
        display();




        

        



      });

    </script>
  </body>
</html>
